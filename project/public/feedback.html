<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hike Feedback</title>
</head>
<body>
    <h1>Hike Feedback</h1>
    <p id="hikeInfo">Loading hike feedback...</p>

    <table id="feedbackTable" border="1">
        <thead>
            <tr>
                <th>Feedback ID</th>
                <th>Rating</th>
                <th>Review</th>
                <th>Date Submitted</th>
                <th>User ID</th>
                <th>Hike ID</th>
            </tr>
        </thead>
        <tbody>
            <tr><td colspan="6">Loading...</td></tr>
        </tbody>
    </table>

    <p style="margin-top: 16px;">
        <a href="index.html">‚Üê Back to hikes</a>
    </p>

    <script>
        async function loadFeedback() {
            const params = new URLSearchParams(window.location.search);
            const hikeId = params.get('hikeId');
            const info = document.getElementById('hikeInfo');
            const tableBody = document.getElementById('feedbackTable').querySelector('tbody');

            if (!hikeId) {
                info.textContent = 'No hike selected.';
                tableBody.innerHTML = '<tr><td colspan="6">No hike ID provided.</td></tr>';
                return;
            }

            info.textContent = `Showing feedback for Hike ID ${hikeId}`;

            const response = await fetch('/feedback', { method: 'GET' });
            const responseData = await response.json();
            const feedbackRows = (responseData.data || []).filter((row) => `${row[5]}` === `${hikeId}`);

            tableBody.innerHTML = '';
            if (feedbackRows.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6">No feedback found for this hike.</td></tr>';
                return;
            }

            feedbackRows.forEach((feedback) => {
                const row = tableBody.insertRow();
                feedback.forEach((value) => {
                    const cell = row.insertCell();
                    cell.textContent = value;
                });
            });
        }

        window.onload = loadFeedback;
    </script>
</body>
</html>
